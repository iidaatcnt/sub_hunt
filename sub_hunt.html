<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sub Hunt - æ½œæ°´è‰¦ã‚²ãƒ¼ãƒ </title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(to bottom, #87CEEB 0%, #4682B4 20%, #191970 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            color: white;
        }
        
        #gameCanvas {
            border: 3px solid #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            background: linear-gradient(to bottom, #87CEEB 0%, #87CEEB 15%, #4682B4 15%, #191970 100%);
        }
        
        #gameInfo {
            display: flex;
            gap: 30px;
            margin: 20px 0;
            font-size: 20px;
            font-weight: bold;
        }
        
        #instructions {
            max-width: 600px;
            text-align: center;
            margin: 20px;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
        }
        
        button {
            padding: 10px 20px;
            font-size: 16px;
            background: #FF6347;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        
        button:hover {
            background: #FF4500;
        }
    </style>
</head>
<body>
    <h1>ğŸš¢ Sub Hunt - æ½œæ°´è‰¦ã‚²ãƒ¼ãƒ  ğŸ™</h1>
    
    <div id="gameInfo">
        <div>ã‚¹ã‚³ã‚¢: <span id="score">0</span></div>
        <div>çˆ†å¼¾: <span id="bombs">20</span></div>
        <div>ãƒ¬ãƒ™ãƒ«: <span id="level">1</span></div>
        <div>é€£ç¶š: <span id="consecutive">0</span></div>
    </div>
    
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    
    <div id="instructions">
        <p>ğŸ¯ <strong>éŠã³æ–¹:</strong></p>
        <p>â†â†’ã‚­ãƒ¼ï¼ˆã¾ãŸã¯Aãƒ»Dã‚­ãƒ¼ï¼‰ã§èˆ¹ã‚’å·¦å³ã«ç§»å‹•<br>
        ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã¾ãŸã¯Zã‚­ãƒ¼ã§å·¦å´ã‹ã‚‰çˆ†å¼¾æŠ•ä¸‹<br>
        Xã‚­ãƒ¼ã§å³å´ã‹ã‚‰çˆ†å¼¾æŠ•ä¸‹ï¼ˆãƒã‚¦ã‚¹ã‚¯ãƒªãƒƒã‚¯ã‚‚å¯èƒ½ï¼‰<br>
        æ½œæ°´è‰¦ã®ç§»å‹•ã‚’äºˆæ¸¬ã—ã¦ç‹™ã„ã‚’å®šã‚ã‚ˆã†ã€‚<br>
        <strong>çˆ†å¼¾è£œå……ãƒ«ãƒ¼ãƒ«:</strong><br>
        ãƒ»ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—æ™‚: +10ç™º<br>
        ãƒ»å¤§å‹æ½œæ°´è‰¦æ’ƒç ´: +2ç™º<br>
        ãƒ»ã‚¯ã‚¸ãƒ©æ’ƒç ´: +5ç™º<br>
        ãƒ»é€£ç¶š5å›ãƒ’ãƒƒãƒˆ: +3ç™º<br>
        ãƒ»30ç§’æ¯ã«è‡ªå‹•è£œå……: +1ç™º</p>
        <button onclick="startGame()">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
        <button onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let gameRunning = false;
        let score = 0;
        let bombsLeft = 20;
        let level = 1;
        let consecutiveHits = 0;
        let lastBombRefillTime = 0;
        
        // ã‚­ãƒ¼å…¥åŠ›ç®¡ç†
        let keys = {};
        
        // ã‚²ãƒ¼ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
        let ship = { x: 400, y: 80, width: 40, height: 20, speed: 3 };
        let bombs = [];
        let submarines = [];
        let whales = [];
        let explosions = [];
        let messages = [];
        
        // æµ·é¢ã®ä½ç½®
        const seaLevel = 120;
        
        // ã‚²ãƒ¼ãƒ è¨­å®š
        const bombSpeed = 1.5;
        const maxBombs = 20;
        
        class Submarine {
            constructor() {
                this.x = Math.random() < 0.5 ? -50 : canvas.width + 50;
                this.y = seaLevel + 50 + Math.random() * 400;
                this.width = 30 + Math.random() * 40;
                this.height = this.width * 0.4;
                this.speed = (Math.random() * 1 + 0.3) * (this.x < 0 ? 1 : -1);
                this.points = Math.floor(100 / (this.width / 30));
                this.isLarge = this.width > 50;
            }
            
            update() {
                this.x += this.speed;
            }
            
            draw() {
                ctx.fillStyle = '#2F4F2F';
                ctx.fillRect(this.x, this.y, this.width, this.height);
                // æ½œæœ›é¡
                ctx.fillRect(this.x + this.width/2, this.y - 5, 2, 5);
                // æ¨é€²å™¨ã®æ³¡
                if (Math.random() < 0.3) {
                    ctx.fillStyle = 'rgba(255,255,255,0.6)';
                    let bubbleX = this.speed > 0 ? this.x - 5 : this.x + this.width + 5;
                    ctx.fillRect(bubbleX, this.y + this.height/2, 3, 3);
                }
            }
            
            isOffScreen() {
                return this.x < -100 || this.x > canvas.width + 100;
            }
        }
        
        class Whale {
            constructor() {
                this.x = Math.random() * (canvas.width - 80);
                this.y = seaLevel + 150 + Math.random() * 250;
                this.width = 80;
                this.height = 40;
                this.speedX = (Math.random() - 0.5) * 1;
                this.speedY = (Math.random() - 0.5) * 0.5;
                this.points = 500;
                this.tailOffset = 0;
            }
            
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.tailOffset += 0.1;
                
                // ç”»é¢ç«¯ã§åè»¢
                if (this.x < 0 || this.x > canvas.width - this.width) {
                    this.speedX *= -1;
                }
                if (this.y < seaLevel + 100 || this.y > canvas.height - this.height) {
                    this.speedY *= -1;
                }
                
                // ãƒ©ãƒ³ãƒ€ãƒ ã«æ–¹å‘è»¢æ›
                if (Math.random() < 0.01) {
                    this.speedX = (Math.random() - 0.5) * 1;
                    this.speedY = (Math.random() - 0.5) * 0.5;
                }
            }
            
            draw() {
                // ã‚¯ã‚¸ãƒ©ã®æœ¬ä½“ï¼ˆæ¥•å††å½¢ï¼‰
                ctx.fillStyle = '#4169E1';
                ctx.beginPath();
                ctx.ellipse(this.x + this.width/2, this.y + this.height/2, this.width/2, this.height/2, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // å°»å°¾
                ctx.fillStyle = '#4169E1';
                let tailX = this.speedX > 0 ? this.x - 15 : this.x + this.width + 5;
                let tailY = this.y + this.height/2;
                let tailWave = Math.sin(this.tailOffset) * 5;
                
                ctx.beginPath();
                ctx.moveTo(tailX, tailY);
                ctx.lineTo(tailX - 10, tailY - 15 + tailWave);
                ctx.lineTo(tailX - 10, tailY + 15 + tailWave);
                ctx.closePath();
                ctx.fill();
                
                // ç›®
                ctx.fillStyle = 'white';
                let eyeX = this.speedX > 0 ? this.x + 15 : this.x + this.width - 25;
                ctx.beginPath();
                ctx.arc(eyeX, this.y + 12, 6, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = 'black';
                ctx.beginPath();
                ctx.arc(eyeX, this.y + 12, 3, 0, Math.PI * 2);
                ctx.fill();
                
                // å£
                ctx.strokeStyle = '#000080';
                ctx.lineWidth = 2;
                ctx.beginPath();
                let mouthX = this.speedX > 0 ? this.x + 5 : this.x + this.width - 15;
                ctx.arc(mouthX, this.y + 25, 8, 0, Math.PI);
                ctx.stroke();
                
                // æ°´ã—ã¶ãï¼ˆãŸã¾ã«ï¼‰
                if (Math.random() < 0.1) {
                    ctx.fillStyle = 'rgba(255,255,255,0.7)';
                    let spoutX = this.x + this.width/2;
                    let spoutY = this.y - 5;
                    ctx.fillRect(spoutX - 2, spoutY - 10, 4, 10);
                    ctx.fillRect(spoutX - 4, spoutY - 15, 2, 5);
                    ctx.fillRect(spoutX + 2, spoutY - 15, 2, 5);
                }
            }
        }
        
        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ 
        class Message {
            constructor(text, x, y) {
                this.text = text;
                this.x = x;
                this.y = y;
                this.life = 60;
                this.alpha = 1;
            }
            
            update() {
                this.y -= 1;
                this.life--;
                this.alpha = this.life / 60;
            }
            
            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = '#FFD700';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.strokeText(this.text, this.x, this.y);
                ctx.fillText(this.text, this.x, this.y);
                ctx.restore();
            }
            
            isDead() {
                return this.life <= 0;
            }
        }
        
        function showMessage(text, x, y) {
            messages.push(new Message(text, x, y));
        }
        
        class Bomb {
            constructor(x, y, side) {
                this.x = x;
                this.y = y;
                this.radius = 3;
                this.side = side;
            }
            
            update() {
                this.y += bombSpeed;
            }
            
            draw() {
                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                
                // çˆ†å¼¾ã®è»Œè·¡
                ctx.strokeStyle = 'rgba(0,0,0,0.3)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(this.x, this.y - 10);
                ctx.lineTo(this.x, this.y);
                ctx.stroke();
            }
            
            isOffScreen() {
                return this.y > canvas.height;
            }
        }
        
        class Explosion {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.radius = 0;
                this.maxRadius = 30;
                this.life = 30;
            }
            
            update() {
                this.radius += 2;
                this.life--;
            }
            
            draw() {
                let alpha = this.life / 30;
                ctx.fillStyle = `rgba(255, 165, 0, ${alpha})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = `rgba(255, 255, 0, ${alpha * 0.7})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius * 0.6, 0, Math.PI * 2);
                ctx.fill();
            }
            
            isDead() {
                return this.life <= 0;
            }
        }
        
        function spawnSubmarine() {
            if (submarines.length < 3 + level) {
                submarines.push(new Submarine());
            }
        }
        
        function spawnWhale() {
            if (whales.length < 1 && Math.random() < 0.01) {
                whales.push(new Whale());
            }
        }
        
        function checkCollisions() {
            bombs.forEach((bomb, bombIndex) => {
                // æ½œæ°´è‰¦ã¨ã®è¡çª
                submarines.forEach((sub, subIndex) => {
                    if (bomb.x > sub.x && bomb.x < sub.x + sub.width &&
                        bomb.y > sub.y && bomb.y < sub.y + sub.height) {
                        explosions.push(new Explosion(bomb.x, bomb.y));
                        score += sub.points;
                        consecutiveHits++;
                        
                        // å¤§å‹æ½œæ°´è‰¦æ’ƒç ´ã§çˆ†å¼¾+2
                        if (sub.isLarge) {
                            bombsLeft += 2;
                            showMessage("+2 çˆ†å¼¾ï¼", bomb.x, bomb.y - 30);
                        }
                        
                        // é€£ç¶šãƒ’ãƒƒãƒˆ5å›ã§çˆ†å¼¾+3
                        if (consecutiveHits >= 5) {
                            bombsLeft += 3;
                            consecutiveHits = 0;
                            showMessage("é€£ç¶šãƒ’ãƒƒãƒˆï¼+3 çˆ†å¼¾ï¼", bomb.x, bomb.y - 50);
                        }
                        
                        bombs.splice(bombIndex, 1);
                        submarines.splice(subIndex, 1);
                    }
                });
                
                // ã‚¯ã‚¸ãƒ©ã¨ã®è¡çª
                whales.forEach((whale, whaleIndex) => {
                    let distance = Math.sqrt(
                        Math.pow(bomb.x - (whale.x + whale.width/2), 2) +
                        Math.pow(bomb.y - (whale.y + whale.height/2), 2)
                    );
                    if (distance < whale.width/2) {
                        explosions.push(new Explosion(bomb.x, bomb.y));
                        score += whale.points;
                        consecutiveHits++;
                        
                        // ã‚¯ã‚¸ãƒ©æ’ƒç ´ã§çˆ†å¼¾+5
                        bombsLeft += 5;
                        showMessage("ã‚¯ã‚¸ãƒ©æ’ƒç ´ï¼+5 çˆ†å¼¾ï¼", bomb.x, bomb.y - 30);
                        
                        bombs.splice(bombIndex, 1);
                        whales.splice(whaleIndex, 1);
                    }
                });
            });
            
            // çˆ†å¼¾ãŒå¤–ã‚ŒãŸå ´åˆï¼ˆæµ·åº•ã«åˆ°é”ï¼‰
            bombs.forEach((bomb, bombIndex) => {
                if (bomb.y >= canvas.height - 10) {
                    consecutiveHits = 0;
                }
            });
        }
        
        function updateGame() {
            if (!gameRunning) return;
            
            // èˆ¹ã®ç§»å‹•
            if (keys['ArrowLeft'] || keys['a'] || keys['A']) {
                ship.x = Math.max(ship.width/2, ship.x - ship.speed);
            }
            if (keys['ArrowRight'] || keys['d'] || keys['D']) {
                ship.x = Math.min(canvas.width - ship.width/2, ship.x + ship.speed);
            }
            
            // æ½œæ°´è‰¦ã®æ›´æ–°
            submarines.forEach((sub, index) => {
                sub.update();
                if (sub.isOffScreen()) {
                    submarines.splice(index, 1);
                }
            });
            
            // ã‚¯ã‚¸ãƒ©ã®æ›´æ–°
            whales.forEach(whale => whale.update());
            
            // çˆ†å¼¾ã®æ›´æ–°
            bombs.forEach((bomb, index) => {
                bomb.update();
                if (bomb.isOffScreen()) {
                    bombs.splice(index, 1);
                }
            });
            
            // çˆ†ç™ºã®æ›´æ–°
            explosions.forEach((explosion, index) => {
                explosion.update();
                if (explosion.isDead()) {
                    explosions.splice(index, 1);
                }
            });
            
            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ›´æ–°
            messages.forEach((message, index) => {
                message.update();
                if (message.isDead()) {
                    messages.splice(index, 1);
                }
            });
            
            // è¡çªåˆ¤å®š
            checkCollisions();
            
            // æ–°ã—ã„æ•µã®ç”Ÿæˆ
            if (Math.random() < 0.02) spawnSubmarine();
            spawnWhale();
            
            // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯
            let newLevel = Math.floor(score / 1000) + 1;
            if (newLevel > level) {
                let levelDiff = newLevel - level;
                level = newLevel;
                bombsLeft += levelDiff * 10;
                showMessage(`ãƒ¬ãƒ™ãƒ« ${level}ï¼+${levelDiff * 10} çˆ†å¼¾ï¼`, canvas.width/2, canvas.height/2);
            }
            
            // æ™‚é–“çµŒéã«ã‚ˆã‚‹çˆ†å¼¾è£œå……ï¼ˆ30ç§’æ¯ã«1ç™ºï¼‰
            let currentTime = Date.now();
            if (currentTime - lastBombRefillTime > 30000) {
                bombsLeft += 1;
                lastBombRefillTime = currentTime;
                showMessage("+1 çˆ†å¼¾ï¼", canvas.width/2, 50);
            }
            
            // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®š
            if (bombsLeft <= 0 && bombs.length === 0) {
                gameRunning = false;
                alert(`ã‚²ãƒ¼ãƒ çµ‚äº†ï¼ã‚¹ã‚³ã‚¢: ${score} ãƒ¬ãƒ™ãƒ«: ${level}`);
            }
        }
        
        function drawGame() {
            // èƒŒæ™¯ã‚’ã‚¯ãƒªã‚¢
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // æµ·é¢ãƒ©ã‚¤ãƒ³
            ctx.strokeStyle = '#4682B4';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(0, seaLevel);
            ctx.lineTo(canvas.width, seaLevel);
            ctx.stroke();
            
            // èˆ¹ã®æç”»
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(ship.x - ship.width/2, ship.y, ship.width, ship.height);
            ctx.fillStyle = '#654321';
            ctx.fillRect(ship.x - ship.width/4, ship.y - 10, ship.width/2, 10);
            
            // ã‚²ãƒ¼ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æç”»
            submarines.forEach(sub => sub.draw());
            whales.forEach(whale => whale.draw());
            bombs.forEach(bomb => bomb.draw());
            explosions.forEach(explosion => explosion.draw());
            messages.forEach(message => message.draw());
            
            // UIæ›´æ–°
            document.getElementById('score').textContent = score;
            document.getElementById('bombs').textContent = bombsLeft;
            document.getElementById('level').textContent = level;
            document.getElementById('consecutive').textContent = consecutiveHits;
        }
        
        function gameLoop() {
            updateGame();
            drawGame();
            requestAnimationFrame(gameLoop);
        }
        
        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            // ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã¾ãŸã¯Zã‚­ãƒ¼ã§çˆ†å¼¾æŠ•ä¸‹ï¼ˆå·¦å´ï¼‰
            if ((e.key === ' ' || e.key.toLowerCase() === 'z') && gameRunning && bombsLeft > 0) {
                e.preventDefault();
                bombs.push(new Bomb(ship.x - ship.width/4, ship.y + ship.height, 'left'));
                bombsLeft--;
            }
            
            // Xã‚­ãƒ¼ã§çˆ†å¼¾æŠ•ä¸‹ï¼ˆå³å´ï¼‰
            if (e.key.toLowerCase() === 'x' && gameRunning && bombsLeft > 0) {
                bombs.push(new Bomb(ship.x + ship.width/4, ship.y + ship.height, 'right'));
                bombsLeft--;
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        canvas.addEventListener('click', (e) => {
            if (!gameRunning || bombsLeft <= 0) return;
            const rect = canvas.getBoundingClientRect();
            let clickX = e.clientX - rect.left;
            
            // ã‚¯ãƒªãƒƒã‚¯ä½ç½®ãŒèˆ¹ã®ä¸­å¤®ã‚ˆã‚Šå·¦ãªã‚‰å·¦å´ã‹ã‚‰ã€å³ãªã‚‰å³å´ã‹ã‚‰çˆ†å¼¾æŠ•ä¸‹
            if (clickX < ship.x) {
                bombs.push(new Bomb(ship.x - ship.width/4, ship.y + ship.height, 'left'));
            } else {
                bombs.push(new Bomb(ship.x + ship.width/4, ship.y + ship.height, 'right'));
            }
            bombsLeft--;
        });
        
        function startGame() {
            gameRunning = true;
            score = 0;
            bombsLeft = maxBombs;
            level = 1;
            consecutiveHits = 0;
            lastBombRefillTime = Date.now();
            bombs = [];
            submarines = [];
            whales = [];
            explosions = [];
            messages = [];
            ship.x = canvas.width / 2;
        }
        
        function resetGame() {
            gameRunning = false;
            startGame();
        }
        
        // ã‚²ãƒ¼ãƒ é–‹å§‹
        gameLoop();
    </script>
</body>
</html>